#!/bin/bash

set -e

green=$'\e[1;32m'
yellow=$'\e[1;33m'
end=$'\e[0m'

echo "${yellow}UPDATESERVICE: Pre-installation starts ...${end}"

printf "Configuring image metadata ... "
# determine build number generated by pipeline
[[ -e /setup/build ]] && BUILD=$(cat /setup/build)
[[ -z ${BUILD} ]] && BUILD='unknown'
# add image info to metadata
captool metadata --addimage -i updateservice -v ${UPDATESERVICE_VERSION} -b ${BUILD}
printf "${green}OK\n${end}"

echo "${yellow}UPDATESERVICE: Pre-installation completed.${end}"
